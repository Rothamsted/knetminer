#!/usr/bin/env bash
#

myname=$(basename $0)

dataset_dir="$1"

if [[ -z "$dataset_dir" ]] || [[ "$dataset_dir" == '--help' ]] || [[ "$dataset_dir" == '-h' ]]; then
	cat <<EOT


	$myname <dataset volume path>
	
Deletes application-generated data on a Knetminer dataset directory, so that the Knetminer
container can regenerate fresh versions of the new files.

For instance, $myname /home/wheat-dataset will clean-up data in the data/ subdirectories, under the
targeted wheat-dataset/ directory. the contents of those dirs are generated by the application (typically the Docker
container). 

Files like data/knowledge-network.oxl are left untouched, since this has read-only data that you need to provide 
from the extern in order to run Knetminer against it.
  

EOT
	exit 1
fi 

set -e # Stop upon errors 

function check_readable_dir
{
  dir="$1"
	[[ -d "$dir" && -r "$dir" && -w "$dir" ]] && return
	
	echo -e "WARNING: '$dir' isn't accessible"
	false
}

echo -e "\n\n"
check_readable_dir "$dataset_dir" || exit 1

cd "$dataset_dir"

if check_readable_dir "$dataset_dir/data"; then
	cd data
	echo -e "Cleaning data"
	rm -Rf *.tab index map*
	rm -f concepts2Genes genes2Concepts genes2PathLengths
fi

echo -e "\nThe end\n"
